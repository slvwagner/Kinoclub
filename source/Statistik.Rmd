---
title: "Statistik Kinoklub"
output: 
  html_document:
    css: "Kinoklub_dark.css"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
act_date <- Sys.time()|>as.Date()
act_date <- paste0(day(act_date),".", month(act_date),".", year(act_date))

```

Bericht wurde am `r act_date` erstellt.

## Statistik

### Eintritte
```{r }
df_Eintritt|>
  group_by(Platzkategorie)|>
  reframe(Anzahl = sum(Anzahl),
          `Film Umsatz [CHF]` = sum(Umsatz))|>
  knitr::kable()

```

```{r}
df_Eintritt|>
  reframe(`Film Umsatz [CHF]` = sum(Umsatz))|>
  knitr::kable()
```


```{r }
df_Eintritt|>
  select(Platzkategorie, Verkaufspreis, Anzahl, Umsatz, Zahlend)|>
  group_by(Zahlend)|>
  reframe(Anzahl = sum(Anzahl))|>
  mutate(Zahlend = if_else(Zahlend, "Zahlend", "Gratis"))|>
  rename(Eintritt = Zahlend)|>
  knitr::kable()

```



### Kiosk 

### Verkaufsartikel 

```{r }
df_Kiosk|>
  select(-Betrag)|>
  group_by(Verkaufsartikel)|>
  reframe(Anzahl = sum(Anzahl), 
          `Umsatz [CHF]` = sum(Kassiert),
          `Gewinn [CHF]` = sum(Gewinn)
          )|>
  arrange(desc(Anzahl))|>
  knitr::kable()
```



```{r }
df_Kiosk|>
  reframe(`Anzahl verkaufter Verkaufsartikel` = sum(Anzahl),
          `Umsatz Kiosk [CHF]` = sum(Kassiert),
          `Gewinn Kiosk [CHF]` = sum(Gewinn) ,
          )|>
  arrange(desc(`Anzahl verkaufter Verkaufsartikel`))|>
  knitr::kable()
```

### Ladenhüter (keine Verkäufe)
```{r }

df_temp <- df_Einkaufspreise|>
  distinct(`Artikelname Kassensystem`)|>
  left_join(df_Kiosk|>
            group_by(Verkaufsartikel)|>
              reframe(Anzahl = sum(Anzahl)),
            by = c("Artikelname Kassensystem"="Verkaufsartikel")
            )
  
df_temp|>
  filter(is.na(Anzahl))|>
  select(-Anzahl)|>
  knitr::kable()

```
### Kiosk Umsatz pro Gast

```{r }
df_temp <- df_show |>
  left_join(
    df_Eintritt |>
      group_by(Datum) |>
      reframe(`Besucher` = sum(Anzahl))|>
      left_join(df_Kiosk |>
                  group_by(Datum) |>
                  reframe(Umsatz = sum(Kassiert)),
                by = join_by(Datum)
                ) |>
      mutate(`Umsatz pro Gast` = (Umsatz / `Besucher`) |> round(2)),
  by = join_by(Datum)
  )|>
  select(-Ende, -Saal, -Version, -Alter)|>
  filter(!is.na(`Suisa Nummer`))

df_temp|>
  knitr::kable()

df_temp|>
  reframe(`Umsatz pro Gast [CHF]` = sum(Umsatz)/sum(Besucher))|>
  knitr::kable()

```


### Kiosk Umsatz pro zahlender Gast
```{r }
df_temp <- df_show |>
  left_join(
    df_Eintritt |>
      filter(Zahlend)|>
      group_by(Datum) |>
      reframe(`Besucher` = sum(Anzahl))|>
      left_join(df_Kiosk |>
                  group_by(Datum) |>
                  reframe(Umsatz = sum(Kassiert)),
                by = join_by(Datum)
                ) |>
      mutate(`Umsatz pro Gast` = (Umsatz / `Besucher`) |> round(2)),
  by = join_by(Datum)
  )|>
  select(-Ende, -Saal, -Version, -Alter)|>
  filter(!is.na(`Suisa Nummer`))

df_temp|>
  knitr::kable()

df_temp|>
  reframe(`Umsatz pro Gast [CHF]` = sum(Umsatz)/sum(Besucher))|>
  knitr::kable()
```

