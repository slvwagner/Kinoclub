---
title: "Jahresabrechnung Kinoklub"
output: 
  html_document:
    css: Kinoklub_dark.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
act_date <- Sys.time()|>as.Date()
act_date <- paste0(lubridate::day(act_date),".", lubridate::month(act_date),".", lubridate::year(act_date))
```

Bericht wurde am `r act_date` erstellt.

## Filmvorführungen

### Eintritte
#### Zahlend / Gratis 
```{r}
df_Eintritt|>
  group_by(Zahlend)|>
  reframe(Anzahl = sum(Anzahl))|>
  mutate(Zahlend = if_else(Zahlend, "Zahlend", "Gratis"))|>
  knitr::kable()
```


### Einnahmen Ticketverkauf
```{r}
df_Eintritt|>
  filter(Zahlend)|>
  group_by(Platzkategorie)|>
  reframe(`Umsatz [CHF]` = sum(Umsatz, na.rm = T))|>
  arrange(desc(`Umsatz [CHF]`))|>
  knitr::kable()
```


```{r}
df_Eintritt|>
  reframe(`Summe [CHF]` = sum(Umsatz, na.rm = T))|>
  arrange(desc(`Summe [CHF]`))|>
  knitr::kable()
```


### Abgaben Tickteverkauf

```{r echo=FALSE}
if(sum(df_keine_Rechnnung$`keine Verleiherrechnung`)>0) {
  writeLines("Achtung es sind noch nicht alle Filmabrechnungen vorhanden. Die Sonstigen Ausgaben können sich demnach noch ändern.")
}
```

```{r}
df_temp <- df_GV_Eintritt|>
  reframe(`SUISA-Abzug` = sum(`SUISA-Abzug [CHF]`, na.rm = T),
          `Verleiher-Abzug` = sum(`Verleiher-Abzug [CHF]`, na.rm = T),
          `Sonstige Kosten` = sum(`Sonstige Kosten [CHF]`, na.rm = T),
          `MWST auf die Verleiherrechnung` = sum(`MWST auf die Verleiherrechnung [CHF]`, na.rm = T)
          )|>
  pivot_longer(everything(), names_to = "Abgaben", values_to = "Betrag [CHF]")|>
  mutate(`Betrag [CHF]` = `Betrag [CHF]`|>round5Rappen())

df_temp  |>
  knitr::kable()
```

```{r}
df_temp|>
  reframe(`Summe [CHF]` = sum(`Betrag [CHF]`, na.rm = T))|>
  knitr::kable(digits = 2)
```


### Differenz
```{r}
Filmvorführungen <- df_GV_Eintritt|>
  select(Datum, Filmtitel, `Gewinn/Verlust [CHF]`)|>
  reframe(`Summe [CHF]` = sum(`Gewinn/Verlust [CHF]`, na.rm = T))

Filmvorführungen|>
  knitr::kable(digits = 2)
```

## Eventausgaben

```{r}
Eventausgaben|>
  knitr::kable(digits = 2)
```


## Kiosk
### Einahmen

```{r}
KioskEinnahmen <- df_Kiosk|>
  group_by(Verkaufsartikel, Verkaufspreis)|>
  reframe(Anzahl = sum(Anzahl),
          `Betrag [CHF]` = sum(Kassiert, na.rm = T))|>
  arrange(desc(`Betrag [CHF]`))|>
  reframe(`Summe [CHF]` = sum(`Betrag [CHF]`))|>
  arrange(desc(`Summe [CHF]`))

KioskEinnahmen|>
  knitr::kable(digits = 2)
```


### Ausgaben
#### Einkauf Getränke
Die Getränke werden gemeinsam mit der Theaterbar eingekauft und der Lieferant ist Schüwo. 
```{r}
EinkaufGetränke <- df_Kiosk|>
  filter(Lieferant == "Schüwo")|>
  group_by(Verkaufsartikel, Verkaufspreis, Einkaufspreis)|>
  reframe(Anzahl = sum(Anzahl),
          `Betrag [CHF]` = sum(Anzahl  * Einkaufspreis, na.rm = T))|>
  arrange(desc(Anzahl))|>
  reframe(`Summe [CHF]` = sum(`Betrag [CHF]`, na.rm = T))

EinkaufGetränke|>
  knitr::kable()
```


#### Einkauf Kino
```{r echo=FALSE}
EinkaufKino <- Einnahmen_und_Ausgaben[["Ausgaben"]]|>
  filter(Kategorie == "Kiosk")|>
    arrange(Datum)|>   mutate(Datum = paste0(day(Datum),".",month(Datum),".",year(Datum)))|>
  select(Datum, Bezeichnung, Betrag)|>
  rename(`Betrag [CHF]` = Betrag)|>
  reframe(`Summe [CHF]` = sum(`Betrag [CHF]`, na.rm = T))

EinkaufKino|>  
  knitr::kable()
```


### Differenz
```{r}
Kiosk <- tibble(Bezeichnung = c("Einnahmen","Einkauf Getränke", "Einkauf Kino"),
                `Betrag [CHF]` = c(KioskEinnahmen|>pull(),
                                   -(EinkaufGetränke|>pull()),
                                   -(EinkaufKino|>pull()))
                )

Kiosk|>
  knitr::kable()

```

```{r}
Kiosk <- Kiosk|>
  reframe(`Summe [CHF]` = sum(`Betrag [CHF]`,na.rm = T))

Kiosk|>
  knitr::kable()
```

## Kasse
**Achtung!** \
Die Kioskkasse wird auch für Barauszahlung von stornierten Tickets genutzt. 

```{r}
Kasse|>
  knitr::kable()
```

## Werbung

```{r echo=FALSE}
Werbung|>
  knitr::kable()
```


## Vermietungen 

```{r echo=FALSE}
df_temp <- bind_rows(
    tibble(Bezeichnung = "Kinovermietungseinnahmen",
           Einnahmen_und_Ausgaben[["Einnahmen"]] |>
             filter(Kategorie == "Vermietung") |>
             reframe(`Betrag [CHF]` = sum(Betrag, na.rm = T))),
    tibble(Bezeichnung = "Vermietungsausgaben",
           Einnahmen_und_Ausgaben[["Ausgaben"]] |>
             filter(Kategorie == "Vermietung") |>
             reframe(`Betrag [CHF]` = -sum(Betrag, na.rm = T)))
)

df_temp|>
  knitr::kable()

```
```{r}
Vermietung|>
  knitr::kable()
```

## Personalaufwand
```{r echo=FALSE}
Personalaufwand|>
  knitr::kable()

```


## Sonstiges

### Einnahmen
```{r echo=FALSE}
Einnahmen_und_Ausgaben[["Einnahmen"]]|>
  filter(Kategorie == Einnahmen_und_Ausgaben$dropdown$`drop down`[4])|>
  select(Datum, Bezeichnung,Betrag)|>
  rename(`Betrag [CHF]` = Betrag)|>
  arrange(Datum)|>   
  mutate(Datum = paste0(day(Datum),".",month(Datum),".",year(Datum)))|>
  knitr::kable()

```

```{r echo=FALSE}
Einnahmen_und_Ausgaben[["Einnahmen"]]|>
  filter(Kategorie == Einnahmen_und_Ausgaben$dropdown$`drop down`[4])|>
  reframe(`Summe [CHF]` = sum(Betrag, na.rm = T))|>
  knitr::kable()

```

### Ausgaben
```{r echo=FALSE}
Einnahmen_und_Ausgaben[["Ausgaben"]]|>
  filter(Kategorie == Einnahmen_und_Ausgaben$dropdown$`drop down`[4])|>
  select(Datum, Bezeichnung,Betrag)|>
  group_by(Bezeichnung)|>
  reframe(Betrag = sum(Betrag, na.rm = T))|>
  rename(`Betrag [CHF]` = Betrag)|>
  # arrange(Datum)|>
  # mutate(Datum = paste0(day(Datum),".",month(Datum),".",year(Datum)))|>
  knitr::kable()

```

```{r echo=FALSE}
Einnahmen_und_Ausgaben[["Ausgaben"]]|>
  filter(Kategorie == Einnahmen_und_Ausgaben$dropdown$`drop down`[4])|>
  reframe(`Summe [CHF]` = sum(Betrag))|>
  knitr::kable()

```

### Differenz
```{r}
Sonstiges|>
  knitr::kable()

```



## Gewinn / Verlust
```{r echo=FALSE}
if(sum(df_keine_Rechnnung$`keine Verleiherrechnung`)>0) {
  writeLines("Achtung es sind noch nicht alle Filmabrechnungen vorhanden. Die Einnahmen aus dem Ticketverkauf werden sich noch ändern.")
}
```

```{r}
GewinnVerlust|>
  knitr::kable()
```

```{r}
GewinnVerlust|>
  reframe("Gewinn / Verlust [CHF]" = sum(`Betrag [CHF]`, na.rm = T))|>
  knitr::kable()
```


\
\
\
\
\
\
